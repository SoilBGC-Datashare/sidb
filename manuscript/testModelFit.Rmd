---
title: "Testing multi models to data "
output: 
  pdf_document:
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
packs <- c('SoilR', 'sidb', 'R.utils', 'dplyr')
sapply(packs, require, character.only=TRUE)
rm(list=ls())
```

## Testing multi models to the dataset of SidB database

Here we test three different two-pool model to each individual datasets. 
As a start we test each time series separately to asses the available information. 

```{r sidb database, results='hide'}
db=loadEntries(path="~/sidb/data/")
db_flat=flatterSIDb(db)
```


```{r inipairs}
# The initial parameter for each model structure, First we test the model using these inipar sets, but we change them if they didn't work. 
twopp_inipars= c(0.01, 0.001, 0.1)
twops_inipars= c(0.005, 0.00001, 0.1, 0.01)
twopf_inipars= c(0.005, 0.00001, 0.1, 0.01, 0.01)
```
-

\newpage

# Dataset `r db[[4]]$citationKey` 

This is the results of a depth-warming experiment with two levels of Control and warming. The dataset has 9 column of time, three depth on each warming and control. The variables V3, V5, V7, V9, V11 and V15 are the sd. 

initial carbon unit is `r db[[4]]$initConditions[1, "carbonUnits"]`
```{r, results='hide'}
db[[4]]$citationKey #Bracho2016SBB
ds4 <- db[[4]]
str(ds4$timeSeries)
isCumulative(data.frame(ds4$timeSeries$time,  ds4$timeSeries$control_7.5_15_mean) )
ds4$initConditions$carbonUnits
ds4$variables$V2$units
plotEntry(db[[4]])
```
```{r}
# source.R <- file.path('~/sidb/scripts/multiSidbFit')
# sourceDirectory(source.R, modifiedOnly=TRUE, verbose=TRUE)
# tmp <- multiSidbFit(db = ds4, model = c('twoppFit', 'twopsFit', 'twopfFit'), 
#                     inipars = list(c(twopp_inipars, twops_inipars, twopf_inipars)), 
#                     ic.col = list(3), ts.col = list(NULL))
```


```{r iniC dataset 4}
iniC_C7.5=ds4$initConditions[1, "carbonMean"]
iniC_C20=ds4$initConditions[2,"carbonMean"]
iniC_C50=ds4$initConditions[3,"carbonMean"]
iniC_W7.5=ds4$initConditions[4, "carbonMean"]
iniC_W20=ds4$initConditions[5, "carbonMean"]
iniC_W50=ds4$initConditions[6, "carbonMean"]
```


## V1: Dataset `r db[[4]]$citationKey`, variable `r ds4$variables$V2$name`, site `r ds4$variables$V2$temperature`, depth `r ds4$variables$V2$midDepth`  
```{r}
Mod1_42=twoppFit(timeSeries = ds4$timeSeries[, c(1,2)], initialCarbon =iniC_C7.5*1e4 , inipars = twopp_inipars)
Mod2_42=twopfFit(timeSeries = ds4$timeSeries[, c(1,2)], initialCarbon =iniC_C7.5*1e4 , inipars = twopf_inipars)
Mod3_42=twopsFit(timeSeries = ds4$timeSeries[, c(1,2)], initialCarbon =iniC_C7.5*1e4 , inipars = twops_inipars)
```


```{r}
days42=Mod1_42$SoilRmodel@times
Mlist42=list(Mod1_42, Mod2_42, Mod3_42)

Rs42=sapply(Mlist42, function(x){rowSums(getReleaseFlux(x$SoilRmodel))})
```

```{r}
modelNames42=c("Two-pool parallel" ,"Two-pool feedback", "Two-pool series")
Rt42=lapply(Mlist42, function(x){getReleaseFlux(x$SoilRmodel)})
```


```{r}
par(mfrow=c(2,2))
for(i in c(1:3)){
  matplot(days42, Rt42[[i]], type="l", lty = 1, ylab = ds4$variables$V2$units, xlab="Day", 
          main=modelNames42[i])
  points(ds4$timeSeries[, c(1,2)], pch=19, cex=0.5)
}
par(mfrow=c(1,1))

```
```{r}
aic <- sapply(Mlist42, function(x){x$AIC})
tbldb4 <- data.frame(model=modelNames42, AIC=aic)
knitr::kable(tbldb4)
```


## V4: Dataset `r db[[4]]$citationKey`, variable `r ds4$variables$V4$name`, site `r ds4$variables$V4$temperature`, depth `r ds4$variables$V4$midDepth` 
```{r}
#iniC unit is % and the fluxs are in microg/gSoil/day percent*1e4

Mod1_44=twoppFit(timeSeries = ds4$timeSeries[, c(1,4)], initialCarbon =iniC_C20*1e4 ,  
                 inipars =twopp_inipars ) #0.010 0.001 0.100
Mod2_44=twopfFit(timeSeries = ds4$timeSeries[, c(1,4)], initialCarbon =iniC_C20*1e4 , inipars = twopf_inipars)
Mod3_44=twopsFit(timeSeries = ds4$timeSeries[, c(1,4)], initialCarbon =iniC_C20*1e4 , inipars = twops_inipars)
```


```{r}
days44=Mod1_44$SoilRmodel@times
Mlist44=list(Mod1_44, Mod2_44, Mod3_44)

Rs44=sapply(Mlist44, function(x){rowSums(getReleaseFlux(x$SoilRmodel))})
```

```{r}
modelNames44=c("Two-pool parallel" ,"Two-pool feedback", "Two-pool series")
Rt44=lapply(Mlist44, function(x){getReleaseFlux(x$SoilRmodel)})
```


```{r}
par(mfrow=c(2,2))
for(i in c(1:3)){
  matplot(days44, Rt44[[i]], type="l", lty = 1, ylab = ds4$variables$V4$units, xlab="Day", 
          main=modelNames44[i])
  points(ds4$timeSeries[, c(1,4)], pch=19, cex=0.5)
}
par(mfrow=c(1,1))

```
```{r}
aic <- sapply(Mlist44, function(x){x$AIC})
tbldb44 <- data.frame(model=modelNames44, AIC=aic)
knitr::kable(tbldb44, digits = 2)
```





## V6: Dataset `r db[[4]]$citationKey`, variable `r ds4$variables$V6$name`, site `r ds4$variables$V6$temperature`, depth `r ds4$variables$V6$midDepth` 
```{r}
Mod1_46=twoppFit(timeSeries = ds4$timeSeries[, c(1,6)], initialCarbon =iniC_C50*1e4 , inipars = twopp_inipars)

Mod2_46=twopfFit(timeSeries = ds4$timeSeries[, c(1,6)], initialCarbon =iniC_C50*1e4 , 
                 inipars =twopf_inipars) # c(0.5, 0.00001, 0.1, 0.01, 0.01) #
Mod3_46=twopsFit(timeSeries = ds4$timeSeries[, c(1,6)], initialCarbon =iniC_C50*1e4 , inipars = twops_inipars)
```


```{r}
days46=Mod1_46$SoilRmodel@times
Mlist46=list(Mod1_46, Mod2_46, Mod3_46)

Rs46=sapply(Mlist46, function(x){rowSums(getReleaseFlux(x$SoilRmodel))})
```

```{r}
modelNames46=c("Two-pool parallel" ,"Two-pool feedback", "Two-pool series")
Rt46=lapply(Mlist46, function(x){getReleaseFlux(x$SoilRmodel)})
```


```{r}
par(mfrow=c(2,2))
for(i in c(1:3)){
  matplot(days46, Rt46[[i]], type="l", lty = 1, ylab = ds4$variables$V6$units, xlab="Day", 
          main=modelNames46[i])
  points(ds4$timeSeries[, c(1,6)], pch=19, cex=0.5)
}
par(mfrow=c(1,1))

```
```{r}
aic <- sapply(Mlist46, function(x){x$AIC})
tbldb46 <- data.frame(model=modelNames46, AIC=aic)
knitr::kable(tbldb46, digits = 2)
```



## V8: Dataset `r db[[4]]$citationKey`, variable `r ds4$variables$V8$name`, site `r ds4$variables$V8$temperature`, depth `r ds4$variables$V8$midDepth` 
```{r}
Mod1_48=twoppFit(timeSeries = ds4$timeSeries[, c(1,8)], initialCarbon =iniC_C7.5*1e4 , inipars = twopp_inipars)
Mod2_48=twopfFit(timeSeries = ds4$timeSeries[, c(1,8)], initialCarbon =iniC_C7.5*1e4 , inipars = twopf_inipars)
Mod3_48=twopsFit(timeSeries = ds4$timeSeries[, c(1,8)], initialCarbon =iniC_C7.5*1e4 , inipars = twops_inipars)
```



```{r}
days48=Mod1_48$SoilRmodel@times
Mlist48=list(Mod1_48, Mod2_48, Mod3_48)

Rs48=sapply(Mlist48, function(x){rowSums(getReleaseFlux(x$SoilRmodel))})
```

```{r}
modelNames48=c("Two-pool parallel" ,"Two-pool feedback", "Two-pool series")
Rt48=lapply(Mlist48, function(x){getReleaseFlux(x$SoilRmodel)})
```


```{r}
par(mfrow=c(2,2))
for(i in c(1:3)){
  matplot(days48, Rt48[[i]], type="l", lty = 1, ylab = ds4$variables$V8$units, xlab="Day", 
          main=modelNames48[i])
  points(ds4$timeSeries[, c(1,8)], pch=19, cex=0.5)
}
par(mfrow=c(1,1))

```
```{r}
aic <- sapply(Mlist48, function(x){x$AIC})
tbldb48 <- data.frame(model=modelNames48, AIC=aic)
knitr::kable(tbldb48, digits = 2)
```


## V10: Dataset `r db[[4]]$citationKey`, variable `r ds4$variables$V10$name`, site `r ds4$variables$V10$temperature`, depth `r ds4$variables$V10$midDepth` 
```{r}
Mod1_410=twoppFit(timeSeries = ds4$timeSeries[, c(1,10)], initialCarbon =iniC_C20*1e4 , inipars = twopp_inipars)
Mod2_410=twopfFit(timeSeries = ds4$timeSeries[, c(1,10)], initialCarbon =iniC_C20*1e4 , inipars = twopf_inipars)
Mod3_410=twopsFit(timeSeries = ds4$timeSeries[, c(1,10)], initialCarbon =iniC_C20*1e4 , 
                  inipars = twops_inipars) #c(0.05, 1e-5, 0.1, 0.01 ))  #
```


```{r}
days410=Mod1_410$SoilRmodel@times
Mlist410=list(Mod1_410, Mod2_410, Mod3_410)

Rs410=sapply(Mlist410, function(x){rowSums(getReleaseFlux(x$SoilRmodel))})
```

```{r}
modelNames410=c("Two-pool parallel" ,"Two-pool feedback", "Two-pool series")
Rt410=lapply(Mlist410, function(x){getReleaseFlux(x$SoilRmodel)})
```


```{r}
par(mfrow=c(2,2))
for(i in c(1:3)){
  matplot(days410, Rt410[[i]], type="l", lty = 1, ylab = ds4$variables$V10$units, xlab="Day", 
          main=modelNames410[i])
  points(ds4$timeSeries[, c(1,10)], pch=19, cex=0.5)
}
par(mfrow=c(1,1))

```
```{r}
aic <- sapply(Mlist410, function(x){x$AIC})
tbldb410 <- data.frame(model=modelNames410, AIC=aic)
knitr::kable(tbldb410, digits = 2)
```


## V12: Dataset `r db[[4]]$citationKey`, variable `r ds4$variables$V12$name`, site `r ds4$variables$V12$temperature`, depth `r ds4$variables$V12$midDepth` 
```{r}
Mod1_412=twoppFit(timeSeries = ds4$timeSeries[, c(1,12)], initialCarbon =iniC_C50*1e4 , inipars = twopp_inipars) #c(0.1, 0.01, 0.1)) #
Mod2_412=twopfFit(timeSeries = ds4$timeSeries[, c(1,12)], initialCarbon =iniC_C50*1e4 , 
                  inipars = twopf_inipars) #c(0.05, 1e-5, 0.1, 0.01, 0.01)) #
Mod3_412=twopsFit(timeSeries = ds4$timeSeries[, c(1,12)], initialCarbon =iniC_C50*1e4 , inipars = twops_inipars)#c(0.05, 1e-5, 0.1, 0.01  )) 

```


```{r}
days412=Mod1_412$SoilRmodel@times
Mlist412=list(Mod1_412, Mod2_412, Mod3_412)

Rs412=sapply(Mlist412, function(x){rowSums(getReleaseFlux(x$SoilRmodel))})
```

```{r}
modelNames412=c("Two-pool parallel" ,"Two-pool feedback", "Two-pool series")
Rt412=lapply(Mlist412, function(x){getReleaseFlux(x$SoilRmodel)})
```


```{r}
par(mfrow=c(2,2))
for(i in c(1:3)){
  matplot(days412, Rt412[[i]], type="l", lty = 1, ylab = ds4$variables$V12$units, xlab="Day", 
          main=modelNames412[i])
  points(ds4$timeSeries[, c(1,12)], pch=19, cex=0.5)
}
par(mfrow=c(1,1))

```
```{r}
aic <- sapply(Mlist412, function(x){x$AIC})
tbldb412 <- data.frame(model=modelNames412, AIC=aic)
knitr::kable(tbldb412, digits = 2)
```

<!---
\newpage

# Dataset `r db[[6]]$citationKey` 

A dataset with 41 variables of `r db_flat$vars$BradleyCook2016[1, "incDesc"] ` in three levels of depth (10, 30, 40)

This dataset is too short. Only 6 observation
```{r, results='hide'}
ds6 <- db[[6]]
str(ds6$timeSeries)
isCumulative(data.frame(ds6$timeSeries$time,  ds6$timeSeries$SG_40_4.5) )
 plotEntry(db[[6]]) 
```

```{r, results= 'hide'}
db[[6]]$citationKey
ds6$initConditions
isCumulative(data.frame(ds6$timeSeries$time, ds6$timeSeries$SG_40_4.5) )
```

```{r, results='hide'}
iniC_G10=ds6$initConditions[1, "carbonMean"]
iniC_G30=ds6$initConditions[2, "carbonMean"]
iniC_S10=ds6$initConditions[3, "carbonMean"]
iniC_S30=ds6$initConditions[4, "carbonMean"]
```

## V2: Dataset `r db[[6]]$citationKey`, variable `r ds6$variables$V2$name`, site `r ds6$variables$V2$temperature`, depth `r ds6$variables$V2$midDepth` 

Time series is too short for two-pool feedback model and two-pool series model 
```{r}
Mod1_62=twoppFit(timeSeries = ds6$timeSeries[, c(1,2)], initialCarbon =iniC_G10*1e5 , inipars = twopp_inipars)
#Mod2_62=twopfFit(timeSeries = ds6$timeSeries[, c(1,2)], initialCarbon =iniC_G10*1e5 , inipars = twopf_inipars)
Mod3_62=twopsFit(timeSeries = ds6$timeSeries[, c(1,2)], initialCarbon =iniC_G10*1e5 , inipars = twops_inipars)
```
## V3: Dataset `r db[[6]]$citationKey`, variable `r ds6$variables$V3$name`, site `r ds6$variables$V3$temperature`, depth `r ds6$variables$V3$midDepth` 
```{r}
Mod1_63=twoppFit(timeSeries = ds6$timeSeries[, c(1,3)], initialCarbon =iniC_G10*1e5 , inipars = twopp_inipars)
#Mod2_63=twopfFit(timeSeries = ds6$timeSeries[, c(1,3)], initialCarbon =iniC_G10*1e5 , inipars = twopf_inipars)
Mod3_63=twopsFit(timeSeries = ds6$timeSeries[, c(1,3)], initialCarbon =iniC_G10*1e5 , inipars = twops_inipars)
```

--->

\newpage

# Dataset `r db[[9]]$citationKey` 

<!--- "Crow2019a" --->
A dataset with 79 variables of `r db_flat$vars$Crow2019a[1, "incDesc"] ` 

```{r, results='hide'}
ds9 <- db[[9]]
ds9$variables$V2$units
str(ds9$timeSeries)
isCumulative(data.frame(ds9$timeSeries$time,  ds9$timeSeries$Site01) )
plotEntry(db[[9]])
```

## V2: Dataset `r db[[9]]$citationKey`, variable `r ds9$variables$V2$name`, site `r ds9$variables$V2$site`
```{r}
Mod1_92=twoppFit(timeSeries = ds9$timeSeries[, c(1,2)], initialCarbon =ds9$initConditions[1, "carbonMean"]*1e4 , inipars = twopp_inipars)
Mod2_92=twopfFit(timeSeries = ds9$timeSeries[, c(1,2)], initialCarbon =ds9$initConditions[1, "carbonMean"]*1e4 , inipars = twopf_inipars)
Mod3_92=twopsFit(timeSeries = ds9$timeSeries[, c(1,2)], initialCarbon =ds9$initConditions[1, "carbonMean"]*1e4 , inipars = twops_inipars)
```

## V3: Dataset `r db[[9]]$citationKey`, variable `r ds9$variables$V3$name`, site `r ds9$variables$V3$site`
```{r}
Mod1_93=twoppFit(timeSeries = ds9$timeSeries[, c(1,3)], initialCarbon =ds9$initConditions[2, "carbonMean"]*1e4 , inipars = twopp_inipars)
Mod2_93=twopfFit(timeSeries = ds9$timeSeries[, c(1,3)], initialCarbon =ds9$initConditions[2, "carbonMean"]*1e4 , inipars = twopf_inipars)
Mod3_93=twopsFit(timeSeries = ds9$timeSeries[, c(1,3)], initialCarbon =ds9$initConditions[2, "carbonMean"]*1e4 , inipars = twops_inipars)
```


## V4: Dataset `r db[[9]]$citationKey`, variable `r ds9$variables$V4$name`, site `r ds9$variables$V4$site`
```{r}
Mod1_94=twoppFit(timeSeries = ds9$timeSeries[, c(1,4)], initialCarbon =ds9$initConditions[3, "carbonMean"]*1e4 , inipars = twopp_inipars)
Mod2_94=twopfFit(timeSeries = ds9$timeSeries[, c(1,4)], initialCarbon =ds9$initConditions[3, "carbonMean"]*1e4 , inipars = twopf_inipars)
Mod3_94=twopsFit(timeSeries = ds9$timeSeries[, c(1,4)], initialCarbon =ds9$initConditions[3, "carbonMean"]*1e4 , inipars = twops_inipars)
```


<!---
\newpage

# Dataset `r db[[11]]$citationKey` 

A dataset with 36 variables of `r db_flat$vars$Dalias2001b[1, "incDesc"] ` , `r db[[11]]$incubationInfo$incDesc` 

** not a soil respiration data base** (Percentage of initially applied C14 remaining over time of incubation)
```{r, results='hide'}
ds11 <- db[[11]]
str(ds11$timeSeries)
isCumulative(data.frame(ds11$timeSeries$time,  ds11$timeSeries$C14_Vin_30) )
plotEntry(db[[11]])
```


```{r, results='hide'}
iniC_Vin=ds11$initConditions[1, "carbonMean"]
iniC_Hal=ds11$initConditions[2, "carbonMean"]
iniC_WalOf=ds11$initConditions[3, "carbonMean"]
iniC_WalOh=ds11$initConditions[4, "carbonMean"]
iniC_ThOh=ds11$initConditions[5, "carbonMean"]
iniC_ThA1=ds11$initConditions[6, "carbonMean"]
iniC_LaA1=ds11$initConditions[7, "carbonMean"]
```


## V2: Dataset `r db[[11]]$citationKey`, variable `r ds11$variables$V2$name`, site `r ds11$variables$V2$site`, temperature `r ds11$variabels$V2$temperature`
```{r}
Mod1_112=twoppFit(timeSeries = ds11$timeSeries[, c(1,2)], initialCarbon =iniC_Vin*1e5 , inipars = twopp_inipars)
Mod2_112=twopfFit(timeSeries = ds11$timeSeries[, c(1,2)], initialCarbon =iniC_Vin*1e5, inipars = twopf_inipars)
Mod3_112=twopsFit(timeSeries = ds11$timeSeries[, c(1,2)], initialCarbon =iniC_Vin*1e5, inipars = twops_inipars)
```

---> 

<!---
\newpage

# Dataset `r db[[12]]$citationKey` 

A dataset with 73 variables of `r db_flat$vars$Doetterl2015[1, "incDesc"] ` , 24 sites with 3 replicate per each site. 

**dataset is too short. 7 observation **

```{r, results='hide'}
ds12 <- db[[12]]
str(ds12$timeSeries)
isCumulative(data.frame(ds12$timeSeries$time,  ds12$timeSeries$SDC22_TSO_1) )
plot(ds12$timeSeries$time, ds12$timeSeries$SDC22_TSO_1)
plotEntry(db[[12]])
```


## V2: Dataset `r db[[12]]$citationKey`, variable `r ds12$variables$V2$name`, site `r ds12$variables$V2$site` replicate 1
```{r}
plot(ds12$timeSeries$time, ds12$timeSeries$SDC22_TSO_1)
# 
# Mod1_122=twoppFit(timeSeries = ds12$timeSeries[, c(1,2)], initialCarbon =ds12$initConditions[1, "carbonMean"]*1e5 , inipars = twopp_inipars)
# Mod2_122=twopfFit(timeSeries = ds12$timeSeries[, c(1,2)], initialCarbon =ds12$initConditions[1, "carbonMean"]*1e5, inipars = twopf_inipars)
#Mod3_122=twopsFit(timeSeries = ds12$timeSeries[, c(1,2)], initialCarbon =ds12$initConditions[1, "carbonMean"]*1e5, inipars = twops_inipars)
```


---> 

\newpage

# Dataset `r db[[15]]$citationKey` 

<!-- "Haddix2011SSSJA" -->

A dataset with 37 variables of `r db_flat$vars$Haddix2011SSSJA[1, "incDesc"] ` 6 different sites each two levels of vegetation (Native grassland and cultivated). and three levels of temperature (15, 25, 35)

```{r, results='hide'}
db[[15]]$citationKey
ds15 <- db[[15]]
str(ds15$timeSeries)
isCumulative(data.frame(ds15$timeSeries$time,  ds15$timeSeries$C_SasNG_15) )
plotEntry(db[[15]])
```



```{r iniC Haddix2011SSSJA}
# the iniC units are g/kg and the fluxes are reported as mg/gSoil/d. There is no need of converting
# g
iniC_SasNG=ds15$initConditions[1, "carbonMean"] # carbon unit g/kg V2, V3, V4
iniC_SasCul=ds15$initConditions[2, "carbonMean"] #V5, V6, V7
iniC_BrzPas=ds15$initConditions[12, "carbonMean"]
```
Units of initial carbon is `r ds15$initConditions[1, 'carbonUnits']` and the fluxes reported as `r ds15$variables$V2$units` 

## V2: Dataset `r db[[15]]$citationKey`, variable `r ds15$variables$V2$name`, site `r ds15$variables$V2$site` , Vegetation `r ds15$variables$V2$vegetation`,temperature `r ds15$variables$V2$temperature`
```{r}
c0= iniC_SasNG*c(0.01, 1-0.01)
ds15$variables$V2$units
ds15$initConditions[1, 'carbonUnits']
Mod1_152=twoppFit(timeSeries = ds15$timeSeries[,c(1,2)], initialCarbon = iniC_SasNG*1e4, inipars = twopp_inipars ) #c(0.1, 0.1, 0.1)
Mod2_152=twopfFit(timeSeries = ds15$timeSeries[, c(1,2)], initialCarbon =iniC_SasNG*1e4, inipars =twopf_inipars) 
Mod3_152=twopsFit(timeSeries = ds15$timeSeries[, c(1,2)], initialCarbon =iniC_SasNG*1e4, inipars = c(0.001, 1e-5, 0.15, 0.01))
```


```{r}
days152=Mod1_152$SoilRmodel@times
Mlist152=list(Mod1_152, Mod2_152, Mod3_152)

Rs152=sapply(Mlist152, function(x){rowSums(getReleaseFlux(x$SoilRmodel))})
```

```{r}
modelNames152=c("Two-pool parallel" ,"Two-pool feedback", "Two-pool series")
Rt152=lapply(Mlist152, function(x){getReleaseFlux(x$SoilRmodel)})
```


```{r}
par(mfrow=c(2,2))
for(i in c(1:3)){
  matplot(days152, Rt152[[i]], type="l", lty = 1, ylab = ds15$variables$V2$units, xlab="Day", 
          main=modelNames152[i])
  points(ds15$timeSeries[, c(1,2)], pch=19, cex=0.5)
}
par(mfrow=c(1,1))

```

```{r}
aic <- sapply(Mlist152, function(x){x$AIC})
tbldb152 <- data.frame(model=modelNames152, AIC=aic)
knitr::kable(tbldb152, digits = 2)
```


## V3: Dataset `r db[[15]]$citationKey`, variable `r ds15$variables$V3$name`, site `r ds15$variables$V3$site` , Vegetation `r ds15$variables$V3$vegetation`,temperature `r ds15$variables$V3$temperature`

```{r}
Mod1_153=twoppFit(timeSeries = ds15$timeSeries[, c(1,3)], initialCarbon =iniC_SasNG*1e5 , inipars = c(0.05, 0.0005, 0.1))
Mod2_153=twopfFit(timeSeries = ds15$timeSeries[, c(1,3)], initialCarbon =iniC_SasNG*1e5, inipars = c(0.05, 5e-5, 0.1, 0.01, 0.01))
Mod3_153=twopsFit(timeSeries = ds15$timeSeries[, c(1,3)], initialCarbon =iniC_SasNG*1e5, inipars = c(0.065, 1e-5, 0.01, 0.01))
```


```{r}
days153=Mod1_153$SoilRmodel@times
Mlist153=list(Mod1_153, Mod2_153, Mod3_153)

Rs153=sapply(Mlist153, function(x){rowSums(getReleaseFlux(x$SoilRmodel))})
```

```{r}
modelNames153=c("Two-pool parallel" ,"Two-pool feedback", "Two-pool series")
Rt153=lapply(Mlist153, function(x){getReleaseFlux(x$SoilRmodel)})
```


```{r}
par(mfrow=c(2,2))
for(i in c(1:3)){
  matplot(days153, Rt153[[i]], type="l", lty = 1, ylab = ds15$variables$V3$units, xlab="Day", 
          main=modelNames153[i])
  points(ds15$timeSeries[, c(1,3)], pch=19, cex=0.5)
}
par(mfrow=c(1,1))

```
```{r}
aic <- sapply(Mlist153, function(x){x$AIC})
tbldb153 <- data.frame(model=modelNames153, AIC=aic)
knitr::kable(tbldb153, digits = 2)
```


## V4: Dataset `r db[[15]]$citationKey`, variable `r ds15$variables$V4$name`, site `r ds15$variables$V4$site` , Vegetation `r ds15$variables$V4$vegetation`,temperature `r ds15$variables$V4$temperature`

```{r}
Mod1_154=twoppFit(timeSeries = ds15$timeSeries[, c(1,4)], initialCarbon =iniC_SasNG*1e5 , inipars = twopp_inipars)
Mod2_154=twopfFit(timeSeries = ds15$timeSeries[, c(1,4)], initialCarbon =iniC_SasNG*1e5, inipars = c(0.05, 5e-5, 0.1, 0.01, 0.01))
Mod3_154=twopsFit(timeSeries = ds15$timeSeries[, c(1,4)], initialCarbon =iniC_SasNG*1e5, inipars = c(0.001, 1e-5, 0.1, 0.01))
```

```{r}
days154=Mod1_154$SoilRmodel@times
Mlist154=list(Mod1_154, Mod2_154, Mod3_154)

Rs154=sapply(Mlist154, function(x){rowSums(getReleaseFlux(x$SoilRmodel))})
```

```{r}
modelNames154=c("Two-pool parallel" ,"Two-pool feedback", "Two-pool series")
Rt154=lapply(Mlist154, function(x){getReleaseFlux(x$SoilRmodel)})
```


```{r}
par(mfrow=c(2,2))
for(i in c(1:3)){
  matplot(days154, Rt154[[i]], type="l", lty = 1, ylab = ds15$variables$V4$units, xlab="Day", 
          main=modelNames154[i])
  points(ds15$timeSeries[, c(1,4)], pch=19, cex=0.5)
}
par(mfrow=c(1,1))

```
```{r}
aic <- sapply(Mlist154, function(x){x$AIC})
tbldb154 <- data.frame(model=modelNames154, AIC=aic)
knitr::kable(tbldb154, digits = 2)
```



## V5: Dataset `r db[[15]]$citationKey`, variable `r ds15$variables$V5$name`, site `r ds15$variables$V5$site` , Vegetation `r ds15$variables$V5$vegetation`,temperature `r ds15$variables$V5$temperature`

```{r}
Mod1_155=twoppFit(timeSeries = ds15$timeSeries[, c(1,5)], initialCarbon =iniC_SasCul*1e5 , inipars = twopp_inipars)
Mod2_155=twopfFit(timeSeries = ds15$timeSeries[, c(1,5)], initialCarbon =iniC_SasCul*1e5, inipars = twopf_inipars)
Mod3_155=twopsFit(timeSeries = ds15$timeSeries[, c(1,5)], initialCarbon =iniC_SasCul*1e5, inipars = c(0.001, 1e-5, 0.01, 0.01))
```


```{r}
days155=Mod1_155$SoilRmodel@times
Mlist155=list(Mod1_155, Mod2_155, Mod3_155)

Rs155=sapply(Mlist155, function(x){rowSums(getReleaseFlux(x$SoilRmodel))})
```

```{r}
modelNames155=c("Two-pool parallel" ,"Two-pool feedback", "Two-pool series")
Rt155=lapply(Mlist155, function(x){getReleaseFlux(x$SoilRmodel)})
```


```{r}
par(mfrow=c(2,2))
for(i in c(1:3)){
  matplot(days155, Rt155[[i]], type="l", lty = 1, ylab = ds15$variables$V5$units, xlab="Day", 
          main=modelNames155[i])
  points(ds15$timeSeries[, c(1,5)], pch=19, cex=0.5)
}
par(mfrow=c(1,1))

```
```{r}
aic <- sapply(Mlist155, function(x){x$AIC})
tbldb155 <- data.frame(model=modelNames155, AIC=aic)
knitr::kable(tbldb155, digits = 2)
```




## V6: Dataset `r db[[15]]$citationKey`, variable `r ds15$variables$V6$name`, site `r ds15$variables$V6$site` , Vegetation `r ds15$variables$V6$vegetation`,temperature `r ds15$variables$V6$temperature`

```{r}
Mod1_156=twoppFit(timeSeries = ds15$timeSeries[, c(1,6)], initialCarbon =iniC_SasCul*1e5 , inipars = twopp_inipars)
Mod2_156=twopfFit(timeSeries = ds15$timeSeries[, c(1,6)], initialCarbon =iniC_SasCul*1e5, inipars = twopf_inipars)
Mod3_156=twopsFit(timeSeries = ds15$timeSeries[, c(1,6)], initialCarbon =iniC_SasCul*1e5, inipars = twops_inipars)
```



## V37: Dataset `r db[[15]]$citationKey`, variable `r ds15$variables$V37$name`, site `r ds15$variables$V37$site` , Vegetation `r ds15$variables$V37$vegetation`,temperature `r ds15$variables$V37$temperature`

```{r}
Mod1_1537=twoppFit(timeSeries = ds15$timeSeries[, c(1,37)], initialCarbon =iniC_BrzPas*1e5 , inipars = twopp_inipars)
#Mod2_1537=twopfFit(timeSeries = ds15$timeSeries[, c(1,37)], initialCarbon =iniC_BrzPas*1e5, inipars = twopf_inipars)
Mod3_1537=twopsFit(timeSeries = ds15$timeSeries[, c(1,37)], initialCarbon =iniC_BrzPas*1e5, inipars = twops_inipars)
```



\newpage
# Dataset `r db[[19]]$citationKey` 

A dataset with 14 variables and 6 different soil types of `r db_flat$vars$NeffHooper2002[1, "incDesc"] `. 

```{r, results='hide'}
db[[19]]$citationKey
ds19 <- db[[19]]
str(ds19$timeSeries)
isCumulative(data.frame(ds19$timeSeries$time,  ds19$timeSeries$CO2_Fair_30) )
plotEntry(ds19)
```


## V2: Dataset of `r db[[19]]$citationKey` variable `r ds19$variables$V2$varDesc` measures as CO2 `r ds19$variables$V2$units` 

```{r V2 CO2_fair30}
iniC_Fair=ds19$initConditions[1, "carbonMean"]  #unit %
Mod1_192=twoppFit(timeSeries = ds19$timeSeries[, c(1,2)], initialCarbon =iniC_Fair*1e5 , inipars = twopp_inipars)
Mod2_192=twopfFit(timeSeries = ds19$timeSeries[, c(1,2)], initialCarbon =iniC_Fair*1e5, inipars = twopf_inipars)
#Mod3_192=twopsFit(timeSeries = ds19$timeSeries[, c(1,2)], initialCarbon =iniC_Fair*1e5, inipars = twops_inipars)
```



## V3: Dataset of `r db[[19]]$citationKey` variable `r ds19$variables$V3$varDesc` measures as CO2 `r ds19$variables$V3$units` 

```{r V3 CO2Chan30}
iniC_Chan=ds19$initConditions[3, "carbonMean"]  #unit %
Mod1_193=twoppFit(timeSeries = ds19$timeSeries[, c(1,3)], initialCarbon =iniC_Chan*1e5 , inipars = twopp_inipars)
Mod2_193=twopfFit(timeSeries = ds19$timeSeries[, c(1,3)], initialCarbon =iniC_Chan*1e5, inipars = twopf_inipars)
#Mod3_193=twopsFit(timeSeries = ds19$timeSeries[, c(1,3)], initialCarbon =iniC_Chan*1e5, inipars = twops_inipars)
```


## V4: Dataset of `r db[[19]]$citationKey` variable `r ds19$variables$V4$varDesc` measures as CO2 `r ds19$variables$V4$units` 

```{r V4 CO2Too30}
iniC_Too=ds19$initConditions[4, "carbonMean"]  #unit %
Mod1_194=twoppFit(timeSeries = ds19$timeSeries[, c(1,4)], initialCarbon =iniC_Too*1e5 , inipars = twopp_inipars)
Mod2_194=twopfFit(timeSeries = ds19$timeSeries[, c(1,4)], initialCarbon =iniC_Too*1e5, inipars = twopf_inipars)
Mod3_194=twopsFit(timeSeries = ds19$timeSeries[, c(1,4)], initialCarbon =iniC_Too*1e5, inipars = twops_inipars)
```



\newpage
# Dataset `r db[[22]]$citationKey` 

A dataset with 25 variables of `r db_flat$vars$Rey2008EJSS[1, "incDesc"] ` 8  different study sites, 3 different depth  (midDepth: 2.5, 7.5, 15). 58 observation

```{r, results='hide'}
db[[22]]$citationKey
ds22 <- db[[22]]
str(ds22$timeSeries)
isCumulative(data.frame(ds22$timeSeries$time,  ds22$timeSeries$CMin_Hain_0_5) )
plotEntry(ds22)
```


## V2: Dataset of `r db[[22]]$citationKey` variable `r ds22$variables$V2$varDesc` measures as CO2 `r ds22$variables$V2$units` 

```{r V2 Min Hain}
iniC_Ha2.5=ds22$initConditions[13, "carbonMean"]  #unit %
Mod1_222=twoppFit(timeSeries = ds22$timeSeries[, c(1,2)], initialCarbon =iniC_Ha2.5*1e5 , inipars = twopp_inipars)
Mod2_222=twopfFit(timeSeries = ds22$timeSeries[, c(1,2)], initialCarbon =iniC_Ha2.5*1e5, inipars = twopf_inipars)
Mod3_222=twopsFit(timeSeries = ds22$timeSeries[, c(1,2)], initialCarbon =iniC_Ha2.5*1e5, inipars = twops_inipars)
```



## V3: Dataset of `r db[[22]]$citationKey` variable `r ds22$variables$V3$varDesc` measures as CO2 `r ds22$variables$V3$units` 

```{r V3 Min Hain}
iniC_Ha7.5=ds22$initConditions[14, "carbonMean"]  #unit %
Mod1_222=twoppFit(timeSeries = ds22$timeSeries[, c(1,3)], initialCarbon =iniC_Ha7.5*1e5 , inipars = twopp_inipars)
Mod2_222=twopfFit(timeSeries = ds22$timeSeries[, c(1,3)], initialCarbon =iniC_Ha7.5*1e5, inipars = twopf_inipars)
Mod3_222=twopsFit(timeSeries = ds22$timeSeries[, c(1,3)], initialCarbon =iniC_Ha7.5*1e5, inipars = twops_inipars)
```


\newpage
# Dataset `r db[[24]]$citationKey` 

A dataset with 17 variables of `r db_flat$vars$Sierra2017BG[1,"incDesc"] `, two levels of temperature, 4 levels of soil moisture and 2 levels of oxygen as treatments


```{r, results='hide'}
db[[24]]$citationKey
ds24 <- db[[24]]
str(ds24$timeSeries)
isCumulative(data.frame(ds24$timeSeries$time,  ds24$timeSeries$TMO_25_15_20) )
plotEntry(ds24)
```


## V2: Dataset of `r db[[24]]$citationKey` variable `r ds24$variables$V2$varDesc` measures as CO2 `r ds24$variables$V2$units` 

```{r}
iniC_ds24=ds24$initConditions[1, "carbonMean"]  #unit mg/mg 
Mod1_242=twoppFit(timeSeries = ds24$timeSeries[, c(1,2)], initialCarbon =iniC_ds24*1000, inipars = twopp_inipars)
#Mod2_242=twopfFit(timeSeries = ds24$timeSeries[, c(1,2)], initialCarbon =iniC_ds24*1000, inipars = twopf_inipars)
#Mod3_242=twopsFit(timeSeries = ds24$timeSeries[, c(1,2)], initialCarbon =iniC_ds24*1000, inipars = twops_inipars)
```



\newpage
# Dataset `r db[[25]]$citationKey` 

A dataset with 16 variables of `r db_flat$vars$Song2010EJSOB[1,"incDesc"] `.

** The dataset is short ** only 7 observation
```{r, results='hide'}
db[[25]]$citationKey
ds25 <- db[[25]]
str(ds25$timeSeries)
isCumulative(data.frame(ds25$timeSeries$time,  ds25$timeSeries$CO2_Cr_5) )
plotEntry(ds25)
```


\newpage
# Dataset `r db[[27]]$citationKey` 

A dataset with 16 variables of `r db_flat$vars$Townsend1997[1,"incDesc"] `.

** The dataset is short ** only 6 observation
```{r, results='hide'}
db[[27]]$citationKey
ds27 <- db[[27]]
str(ds27$timeSeries)
isCumulative(data.frame(ds27$timeSeries$time,  ds27$timeSeries$CO2_Pas100_20) )
plotEntry(ds27)
```



\newpage
# Dataset `r db[[28]]$citationKey` 

A dataset with 16 variables of `r db_flat$vars$Wang2010[1,"incDesc"] `.

** The dataset is short ** only 7 observation
```{r, results='hide'}
db[[28]]$citationKey
ds28 <- db[[28]]
str(ds28$timeSeries)
isCumulative(data.frame(ds28$timeSeries$time,  ds28$timeSeries$CO2_5_10_20_0) )
plotEntry(ds28)
```



\newpage
# Dataset `r db[[30]]$citationKey` 

A dataset with 13 variables of `r db_flat$vars$Winkler1996[1,"incDesc"] `. 15 observation

```{r, results='hide'}
db[[30]]$citationKey
ds30 <- db[[30]]
str(ds30$timeSeries)
isCumulative(data.frame(ds30$timeSeries$time,  ds30$timeSeries$CO2_38_A) )
plotEntry(ds30)
```


## V2: Dataset of `r db[[30]]$citationKey` variable `r ds30$variables$V2$varDesc` measures as CO2 `r ds30$variables$V2$units` 

```{r}
iniC_DF14=ds30$initConditions[1, "carbonMean"]  #unit percent
Mod1_302=twoppFit(timeSeries = ds30$timeSeries[, c(1,2)], initialCarbon =iniC_DF14*1e5, inipars = twopp_inipars)
Mod2_302=twopfFit(timeSeries = ds30$timeSeries[, c(1,2)], initialCarbon =iniC_DF14*1e5, inipars = twopf_inipars)
Mod3_302=twopsFit(timeSeries = ds30$timeSeries[, c(1,2)], initialCarbon =iniC_DF14*1e5, inipars = twops_inipars)
```



\newpage
# Dataset `r db[[31]]$citationKey` 

A dataset with 13 variables of `r db_flat$vars$Winkler1996[1,"incDesc"] `. 15 observation

```{r, results='hide'}
db[[31]]$citationKey
ds31 <- db[[31]]
str(ds31$timeSeries)
isCumulative(data.frame(ds31$timeSeries$time,  ds31$timeSeries$CO2_u20_PP) )
plotEntry(ds31)
```

## V2: Dataset of `r db[[31]]$citationKey` variable `r ds31$variables$V2$varDesc` measures as CO2 `r ds31$variables$V2$units` 

```{r}
iniC_PP=ds31$initConditions[1, "carbonMean"]  #unit percent
Mod1_312=twoppFit(timeSeries = ds31$timeSeries[, c(1,2)], initialCarbon =iniC_PP*1e5, inipars = twopp_inipars)
#Mod2_312=twopfFit(timeSeries = ds31$timeSeries[, c(1,2)], initialCarbon =iniC_PP*1e5, inipars = twopf_inipars)
Mod3_312=twopsFit(timeSeries = ds31$timeSeries[, c(1,2)], initialCarbon =iniC_PP*1e5, inipars = twops_inipars)
```
